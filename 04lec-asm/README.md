## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã
- # –†–∞–∑–¥–µ–ª 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤


–¢–µ–º–∞ 4. –ü—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º
–ö–∞—Ä—Ç–∞ –ø–∞–º—è—Ç–∏. –î–∏—Ä–µ–∫—Ç–∏–≤—ã –∞—Å—Å–µ–º–±–ª–µ—Ä–∞. –ö–æ–º–ø–∏–ª—è—Ü–∏—è, —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—è, –∫–æ–º–ø–æ–Ω–æ–≤–∫–∞. –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º.

–ê—Å—Å–µ–º–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞. –°–±–æ—Ä–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º. –ö–æ–º–ø–∏–ª—è—Ü–∏—è –∏ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—è. –ö–æ–º–ø–æ–Ω–æ–≤–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º. –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—É—é –ø–∞–º—è—Ç—å.

–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞

–ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã –∫–æ–º–ø–æ–Ω–æ–≤—â–∏–∫–∞. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–∞–º–º.

## –û–±—Ä–∞—â–µ–Ω–∏—è –∫ –ø–∞–º—è—Ç–∏
–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞ eax –ø–æ –∞–¥—Ä–µ—Å—É 0x40100, –∞ –ø–æ—Ç–æ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ –≤ —Ä–µ–≥–∏—Å—Ç—Ä ebx:

    mov %eax, 0x40100
    mov 0x40100, %ebx
(–ü—Ä–∏ —ç—Ç–æ–º –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º 4 –±–∞–π—Ç–∞ –ø–æ –∞–¥—Ä–µ—Å–∞–º 0x40100, 0x40101, 0x40102, 0x40103.)

–ü–æ–ª–æ–∂–∏—Ç—å –≤ –ø–∞–º—è—Ç—å –ø–æ –∞–¥—Ä–µ—Å—É 0x40100 —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ 0x1543:

    movl $0x1543, 0x40100
–ö–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞–¥—Ä–µ—Å–æ–≤ –º–µ—Ç–∫–∏:
```
    .global main
main:
    mov x, %eax
    call writei32
    call finish

x:  .int 43
```
–ù–µ –ª—é–±–æ–π –∞–¥—Ä–µ—Å –≤ –ø–∞–º—è—Ç–∏ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —á—Ç–µ–Ω–∏—è –∏ —Ç–µ–º –±–æ–ª–µ–µ –∑–∞–ø–∏—Å–∏:
```
    .global main
main:
    incl x
    call finish

x:  .int 43
```
–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ incl –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç –ø—Ä–æ–≥—Ä–∞–º–º—É —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º ¬´Segmentation fault¬ª, –ø–æ—Å–∫–æ–ª—å–∫—É —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å.

## –°–µ–∫—Ü–∏–∏ .data –∏ .bss
–õ—é–±—ã–µ –±–∞–π—Ç—ã, –ø–æ—Ä–æ–∂–¥–∞–µ–º—ã–µ –∞—Å—Å–µ–º–±–ª–µ—Ä–æ–º, –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –æ–¥–Ω—É –∏–∑ —Å–µ–∫—Ü–∏–π –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —ç—Ç–æ —Å–µ–∫—Ü–∏—è .text, –≤ –∫–æ—Ç–æ—Ä–æ–π –æ–∂–∏–¥–∞–µ—Ç—Å—è –º–∞—à–∏–Ω–Ω—ã–π –∫–æ–¥ –∏ –∫–æ—Ç–æ—Ä–∞—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏.

–î–∞–Ω–Ω—ã–µ –º–æ–∂–Ω–æ –ø–æ–ª–æ–∂–∏—Ç—å –≤ —Å–µ–∫—Ü–∏—é .data:
```
    incl x

    .data
x:  .int 43

    .text
    call finish
```
–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –∞—Å—Å–µ–º–±–ª–µ—Ä —Å–æ–±–∏—Ä–∞–µ—Ç –≤–º–µ—Å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–∞–∂–¥–æ–π –∏–∑ —Å–µ–∫—Ü–∏–π: –≤ –ø—Ä–∏–º–µ—Ä–µ –≤—ã—à–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è call –æ–∫–∞–∂–µ—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ (–∏ –≤ –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–º —Ñ–∞–π–ª–µ) —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ incl.

–ï—Å—Ç—å —Ç–∞–∫–∂–µ —Å–µ–∫—Ü–∏—è .bss, –≤ –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –ø–æ–ª–æ–∂–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–ª–µ–≤—ã–µ –±–∞–π—Ç—ã:
```
    .bss
z:  .int 0
    .int 0
    // .int 83  // would be an error
```
Typical memory layout:
```
           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    Executable file
0x0000_0000‚îÇ//////////////////‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
           ‚îÇ//////////////////‚îÇ   ‚îÇ headers       ‚îÇ
           ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§   ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
           ‚îÇ.text   (read and ‚îÇ   ‚îÇ.text          ‚îÇ
           ‚îÇ         execute) ‚îÇ   ‚îÇ               ‚îÇ
      eip‚îÄ‚ñ∫‚îÇ                  ‚îÇ   ‚îÇ               ‚îÇ
           ‚îÇ                  ‚îÇ   ‚îÇ               ‚îÇ
           ‚îÇ                  ‚îÇ   ‚îÇ               ‚îÇ
           ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§   ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
           ‚îÇ.data   (read and ‚îÇ   ‚îÇ.data          ‚îÇ
           ‚îÇ         write)   ‚îÇ   ‚îÇ               ‚îÇ
           ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ.bss    (read and ‚îÇ
           ‚îÇ         write)   ‚îÇ
           ‚îÇ                  ‚îÇ
           ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
           ‚îÇ//////////////////‚îÇ
           ‚îÇ//////////////////‚îÇ    /// = unmapped region
           ‚îÇ//////////////////‚îÇ          (inaccessible memory)
           ‚îÇ//////////////////‚îÇ
           ‚îÇ//////////////////‚îÇ
           ‚îÇ//////////////////‚îÇ
      esp‚îÄ‚ñ∫‚îÇstack             ‚îÇ
           ‚îÇ                  ‚îÇ
           ‚îÇ                  ‚îÇ
           ‚îÇ                  ‚îÇ
           ‚îÇ                  ‚îÇ
           ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
           ‚îÇ//////////////////‚îÇ
0xffff_ffff‚îÇ//////////////////‚îÇ
           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           
```
–ë—ã–≤–∞—é—Ç read-only –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–µ–∫—Å—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–æ–≥—Ä–∞–º–º—ã), –¥–ª—è –Ω–∏—Ö –µ—Å—Ç—å —Å–µ–∫—Ü–∏—è .rodata. –≠—Ç–∞ —Å–µ–∫—Ü–∏—è –Ω–µ –∏–º–µ–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–∏–≤—ã, –ø–æ—ç—Ç–æ–º—É –Ω—É–∂–Ω–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–∏—Ä–µ–∫—Ç–∏–≤–æ–π .section:
```
    .section .rodata
pi_digits:
    .byte 3,1,4,1,5,9,2,6
```
(–ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ –≤–º–µ—Å—Ç–æ .rodata –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —á–∞—Å—Ç–æ –∫–ª–∞–¥—É—Ç –≤ .text.)

## Endianness
x86 ‚Äî little endian:
```
    // 0x40100:  00 00 00 00  00 00 00 00
    movl $0xabcdef, 0x40100
    // 0x40100:  ef cd ab 00  00 00 00 00
```
–ú–ª–∞–¥—à–∏–π –±–∞–π—Ç –ø–æ –º–ª–∞–¥—à–µ–º—É –∞–¥—Ä–µ—Å—É –≤ –ø–∞–º—è—Ç–∏.

–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ
```
    movzbl %al, %edi  // zero-extend, —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω—É–ª—è–º–∏
    movsbl %al, %edi  // sign-extend, —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∑–Ω–∞–∫–æ–≤—ã–º –±–∏—Ç–æ–º
    cdq  // sign-extend eax to edx:eax
```
–í —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–µ Intel ‚Äî movzx, movsx.

–†–∞–∑–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –∞–¥—Ä–µ—Å–∞—Ü–∏–∏ –≤ x86
```
    mov x + 4, %eax   // –ø—Ä—è–º–∞—è –∞–¥—Ä–µ—Å–∞—Ü–∏—è
    mov $x, %esi      // (–ø–æ–ª–æ–∂–∏–ª–∏ –≤ esi –∞–¥—Ä–µ—Å –º–∞—Å—Å–∏–≤–∞ x)
    mov 4(%esi), %eax // –∫–æ—Å–≤–µ–Ω–Ω–∞—è –∞–¥—Ä–µ—Å–∞—Ü–∏—è

    mov $17, %edi

    // –∑–∞–≥—Ä—É–∂–∞–µ–º –≤ eax 18-–π —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞
    // (–∞–¥—Ä–µ—Å –∫–æ—Ç–æ—Ä–æ–≥–æ %esi + %edi*4)
    mov (%esi, %edi, 4), %eax

    // –¥–µ–ª–∞–µ–º —Ç–æ –∂–µ —Å–∞–º–æ–µ
    mov x(, %edi, 4), %eax

    // –∏ –µ—â—ë —Ä–∞–∑
    mov x + 17 * 4, %eax

    .bss
x:  .skip 4 * 100

x5: .int x + 4*5      // –≤ x5 –ª–µ–∂–∏—Ç –∞–¥—Ä–µ—Å —à–µ—Å—Ç–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –º–∞—Å—Å–∏–≤–∞ x
```
–û–±—â–∏–π –≤–∏–¥ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –ø–∞–º—è—Ç–∏:

    OFFSET(BREG, IREG, SCALE)

–ó–¥–µ—Å—å OFFSET ‚Äî –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –∑–∞–¥–∞–Ω–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ, BREG ‚Äî –±–∞–∑–æ–≤—ã–π —Ä–µ–≥–∏—Å—Ç—Ä, IREG ‚Äî –∏–Ω–¥–µ–∫—Å–Ω—ã–π —Ä–µ–≥–∏—Å—Ç—Ä, —É–º–Ω–æ–∂–∞–µ–º—ã–π –Ω–∞ SCALE (SCALE –º–æ–∂–µ—Ç –±—ã—Ç—å 1, 2, 4 –∏–ª–∏ 8).

–ò—Ç–æ–≥–æ–≤—ã–π –∞–¥—Ä–µ—Å (effective address) –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø–æ —Ñ–æ—Ä–º—É–ª–µ:

    BREG + OFFSET + IREG * SCALE

## –°—Ç–µ–∫
Writable –æ–±–ª–∞—Å—Ç—å –ø–∞–º—è—Ç–∏, –∫–æ—Ç–æ—Ä–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ —Å—Ç–µ–∫ :-). –°—Ç–µ–∫ –Ω–∞ x86 —Ä–∞—Å—Ç—ë—Ç –≤–Ω–∏–∑ (–æ—Ç —Å—Ç–∞—Ä—à–∏—Ö –∞–¥—Ä–µ—Å–æ–≤ –∫ –º–ª–∞–¥—à–∏–º). –ù–∞ –≤–µ—Ä—Ö—É—à–∫—É —Å—Ç–µ–∫–∞ (–ø–µ—Ä–≤—ã–π –∑–∞–Ω—è—Ç—ã–π –±–∞–π—Ç) —É–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä esp.

–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ä—Ö—É—à–∫—É —Å—Ç–µ–∫–∞ (–ø–µ—Ä–≤—ã–µ 4 –±–∞–π—Ç–∞) –≤ —Ä–µ–≥–∏—Å—Ç—Ä eax:

    mov (%esp), %eax
–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –∫–ª–∞—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å—Ç–µ–∫ –∏ –≤—ã—Ç–∞–ª–∫–∏–≤–∞—Ç—å –∏—Ö –æ—Ç—Ç—É–¥–∞, –µ—Å—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:

    push %eax  // —Ç–æ –∂–µ, —á—Ç–æ sub $4, %esp; mov %eax, (%esp)
    pop %eax   // —Ç–æ –∂–µ, —á—Ç–æ mov (%esp), %eax; add $4, %esp
–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è push –æ–¥–Ω–∞ –∏–∑ –Ω–µ–º–Ω–æ–≥–∏—Ö, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –¥–≤—É–º –∞–¥—Ä–µ—Å–∞–º –ø–∞–º—è—Ç–∏ —Å—Ä–∞–∑—É:
```
    .data
x:  .int 1900

    .text
    pushl x  // –≤–∑—è—Ç—å 4 –±–∞–π—Ç–∞ –∏–∑ –ø–∞–º—è—Ç–∏ –ø–æ –∞–¥—Ä–µ—Å—É x
             // –∏ –ø–æ–ª–æ–∂–∏—Ç—å –∏—Ö –≤ —Å—Ç–µ–∫, —Ç–æ –µ—Å—Ç—å —Ç–æ–∂–µ –≤ –ø–∞–º—è—Ç—å
```
–ú–æ–∂–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø–∞–º—è—Ç—å—é –≤—ã—à–µ esp, –µ—Å–ª–∏ –≤—ã –∑–Ω–∞–µ—Ç–µ, —á—Ç–æ —Ç–∞–º —á—Ç–æ-—Ç–æ –µ—Å—Ç—å. –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –≤—ã –ø–æ–ª–æ–∂–∏–ª–∏ –≤ —Å—Ç–µ–∫ –¥–≤–∞ 32-–±–∏—Ç–Ω—ã—Ö —á–∏—Å–ª–∞, –∏—Ö –º–æ–∂–Ω–æ –æ—Ç—Ç—É–¥–∞ —á–∏—Ç–∞—Ç—å –∏ —Ç–∞–º –∏–∑–º–µ–Ω—è—Ç—å:
```
    pushl $6
    pushl $7

    // —Ç–µ–ø–µ—Ä—å —Å—Ç–µ–∫ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:
    //    07 00 00 00  06 00 00 00 ...
    //    ‚Üë esp

    mov 4(%esp), %eax  // –∑–∞–≥—Ä—É–∑–∏–ª–∏ –≤ %eax —á–∏—Å–ª–æ 6
    incl (%esp)        // —Ç–µ–ø–µ—Ä—å –Ω–∞ –≤–µ—Ä—Ö—É—à–∫–µ —Å—Ç–µ–∫–∞ –ª–µ–∂–∏—Ç —á–∏—Å–ª–æ 8
```
–ü–∞–º—è—Ç—å –Ω–∏–∂–µ esp –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ —Å–ª–µ–¥—É–µ—Ç.

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è push %esp –∫–ª–∞–¥—ë—Ç –Ω–∞ —Å—Ç–µ–∫ —Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ esp, –∫–æ—Ç–æ—Ä–æ–µ –±—ã–ª–æ –¥–æ –µ—ë –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è (–Ω–µ —É–º–µ–Ω—å—à–µ–Ω–Ω–æ–µ –Ω–∞ 4).

## –ü–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—ã
–ö–æ–≥–¥–∞ –≤ –î–ó –ø—Ä–æ—Å—è—Ç —Å–¥–∞—Ç—å ¬´—Ñ—É–Ω–∫—Ü–∏—é¬ª –∏–ª–∏ ¬´–ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—É¬ª:

- –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –º–µ—Ç–∫–∏ —Å –∏–º–µ–Ω–µ–º –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—ã;
- –º–µ—Ç–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å .global;
- —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –ø—Ä–æ–≤–µ—Ä—è—é—â—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é ret;
- –µ—Å–ª–∏ –º–µ–Ω—è–µ—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤, –∫—Ä–æ–º–µ eax, ecx –∏ edx, —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –∏—Ö –≤ —Å—Ç–µ–∫ –∏ –ø–æ—Ç–æ–º –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ.

–ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –≤–∞—Å –ø—Ä–æ—Å—è—Ç –Ω–∞–ø–∏—Å–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é foobar, –∏ –≤–∞–º –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä—ã esi –∏ edi:
```
    .global foobar
foobar:
    push %esi
    push %edi
    ... // –¥–µ–ª–∞–µ–º —á—Ç–æ –ø—Ä–æ—Å—è—Ç, –º–æ–∂–µ–º –ø–æ—Ä—Ç–∏—Ç—å esi –∏ edi
    pop %edi // –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
    pop %esi
    ret
```
(–ü–æ–¥—Ä–æ–±–Ω–µ–µ –≤ —Å–ª–µ–¥—É—é—â–µ–π –ª–µ–∫—Ü–∏–∏.)

## –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –û–ó–£
–ú—ã —É–∂–µ –≤–∏–¥–µ–ª–∏ SRAM ‚Äî –ø–∞–º—è—Ç—å –Ω–∞ —Ç—Ä–∏–≥–≥–µ—Ä–∞—Ö.

–û—Å–Ω–æ–≤–Ω—É—é —á–∞—Å—Ç—å –ø–∞–º—è—Ç–∏ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç DRAM: 

![](images/dram.png)

–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä –∏ –ø–∞–º—è—Ç—å –æ–±—â–∞—é—Ç—Å—è –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º —à–∏–Ω—ã (bus): 

![](images/system_bus.png)




## lea
Load effective address ‚Äî –Ω–µ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –ø–∞–º—è—Ç–∏, –∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤ —Ä–µ–≥–∏—Å—Ç—Ä –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–π –∞–¥—Ä–µ—Å:

    lea 4(%esi, %edi, 8), %eax  // —Ç–µ–ø–µ—Ä—å eax = esi + 8*edi + 4

    lea (%eax, %eax, 8), %eax   // —É–º–Ω–æ–∂–∏–ª–∏ eax –Ω–∞ 9 ü§°
–ü–µ—Ä–µ—Ö–æ–¥ –ø–æ –∞–¥—Ä–µ—Å—É –≤ —Ä–µ–≥–∏—Å—Ç—Ä–µ

    jmp *%eax
–ù–∞–ø—Ä–∏–º–µ—Ä:
```
somelabel:
    ...

    ...
    mov $somelabel, %eax
    jmp *%eax
```
–ò–ª–∏ —Ç–∞–∫:
```
func1:
    ...
func2:
    ...

    .section .rodata
functable:
    .int func1
    .int func2

    .text
    ...
    mov functable + 4, %eax
    jmp *%eax
```
## –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ


–ö–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, –ª—É—á—à–µ, —á—Ç–æ–±—ã –º–Ω–æ–≥–æ–±–∞–π—Ç–æ–≤—ã–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –ø–∞–º—è—Ç–∏ –±—ã–ª–∏ –≤—ã—Ä–æ–≤–Ω–µ–Ω—ã (aligned).
```
    // –Ω–∞—á–∞–ª–æ —Å–µ–∫—Ü–∏–∏
    .byte 1
    .int 1    // —ç—Ç–∏ 4 –±–∞–π—Ç–∞ –ª–µ–∂–∞—Ç –ø–æ –∞–¥—Ä–µ—Å—É, –Ω–µ –∫—Ä–∞—Ç–Ω–æ–º—É 4

    .balign 4 // byte align: –∑–¥–µ—Å—å –¥–æ–±–∞–≤–∏—Ç 3 –±–∞–π—Ç–∞ –Ω—É–ª–µ–π
    .int 1    // —ç—Ç–∏ 4 –±–∞–π—Ç–∞ –ª–µ–∂–∞—Ç –ø–æ –∞–¥—Ä–µ—Å—É, –∫—Ä–∞—Ç–Ω–æ–º—É 4

    .balign 2 // –Ω–µ –¥–æ–±–∞–≤–∏—Ç –Ω–∏—á–µ–≥–æ
    .short 1
```
## –ü–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—ã
–ú—ã —Ö–æ—Ç–∏–º –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–¥ ‚Äî –≤—ã–∑—ã–≤–∞—Ç—å –æ–¥–Ω—É –∏ —Ç—É –∂–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Ç–æ—á–µ–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã.
```
double_eax:
    sal $1, %eax
    jmp ...  // –∫—É–¥–∞?
    

    ...
    jmp double_eax
    // —Ö–æ—Ç–∏–º –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–¥–µ—Å—å

    ...
    jmp double_eax
    // –∏–ª–∏ –∑–¥–µ—Å—å
```
–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Ä–µ—à–∞—é—Ç —ç—Ç–æ —Å –ø–æ–º–æ—â—å—é —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞ –¥–ª—è –∞–¥—Ä–µ—Å–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞. –ï—Å–ª–∏ –±—ã —Ç–∞–∫–æ–π –±—ã–ª –≤ x86, –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—ã –º–æ–≥–ª–∏ –±—ã –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:
```
double_eax:
    sal $1, %eax
    jmp *%return_address
    

    ...
    mov $1f, %return_address
    jmp double_eax
1:

    ...
    mov $1f, %return_address
    jmp double_eax
1:
```
–ù–æ –≤ x86 –ø—Ä–∏–Ω—è—Ç–æ –∞–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫–ª–∞—Å—Ç—å –Ω–∞ —Å—Ç–µ–∫:
```
double_eax:
    sal $1, %eax
    pop %edx        // –¥–æ—Å—Ç–∞—ë–º –∏–∑ —Å—Ç–µ–∫–∞ –∞–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞
    jmp *%edx       // –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –ø–æ –Ω–µ–º—É
    

    ...
    push $1f        // –∫–ª–∞–¥—ë–º –≤ —Å—Ç–µ–∫ –∞–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞
                    // (–∞–¥—Ä–µ—Å —Å–ª–µ–¥—É—é—â–µ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ—Å–ª–µ jmp)
    jmp double_eax  // –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –Ω–∞—á–∞–ª–æ –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—ã
1:

    ...
    push $1f
    jmp double_eax
1:
```
–î–ª—è —ç—Ç–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–≤—Ö–æ–¥ –≤ –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—É –∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –∏–∑ –Ω–µ—ë) –µ—Å—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ call –∏ ret:
```
double_eax:
    sal $1, %eax
    ret             // –¥–æ—Å—Ç–∞—ë–º –∏–∑ —Å—Ç–µ–∫–∞ –∞–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞
                    // –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –ø–æ –Ω–µ–º—É
    

    ...
    call double_eax // –∫–ª–∞–¥—ë–º –≤ —Å—Ç–µ–∫ –∞–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞
                    // (–∞–¥—Ä–µ—Å —Å–ª–µ–¥—É—é—â–µ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ—Å–ª–µ call)
                    // –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –Ω–∞—á–∞–ª–æ –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—ã

    ...
    call double_eax
```
–í –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º–µ –≤–∞–∂–Ω–æ —Å–æ–±–ª—é–¥–∞—Ç—å –±–∞–ª–∞–Ω—Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π push –∏ pop, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–æ–º–∞—Ö–Ω—É—Ç—å—Å—è –º–∏–º–æ –∞–¥—Ä–µ—Å–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞.

## –°–æ–≥–ª–∞—à–µ–Ω–∏—è –æ –≤—ã–∑–æ–≤–∞—Ö
–ß—Ç–æ–±—ã —Ä–∞–∑–Ω—ã–µ –ª—é–¥–∏ (–∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä—ã) –º–æ–≥–ª–∏ —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—ã, –∏–º –Ω—É–∂–Ω–æ –¥–æ–≥–æ–≤–æ—Ä–∏—Ç—å—Å—è, –∫–∞–∫ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—É –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∫–∞–∫ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –∫–∞–∫–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–µ –±—É–¥–µ—Ç –ø–æ—Ä—Ç–∏—Ç—å. –¢–∞–∫–∏–µ –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏ –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è —Å–æ–≥–ª–∞—à–µ–Ω–∏—è–º–∏ –æ –≤—ã–∑–æ–≤–∞—Ö (calling conventions).

–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ –Ω–∞—à–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ (Linux/x86) –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è cdecl:

–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ —Å—Ç–µ–∫–µ, –ø—Ä–∏—á—ë–º –ª–µ–∂–∞—Ç –≤ –ø–∞–º—è—Ç–∏ ¬´–ø–æ –ø–æ—Ä—è–¥–∫—É¬ª (–∞–¥—Ä–µ—Å —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å –Ω–æ–º–µ—Ä–æ–º –∞—Ä–≥—É–º–µ–Ω—Ç–∞);
–ø–∞—Ä–∞–º–µ—Ç—Ä—ã —É–¥–∞–ª—è–µ—Ç –∏–∑ —Å—Ç–µ–∫–∞ —Ç–æ—Ç, –∫—Ç–æ –∏—Ö —Ç—É–¥–∞ –ø–æ–ª–æ–∂–∏–ª (—Ç–æ –µ—Å—Ç—å –≤—ã–∑—ã–≤–∞—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è);

–≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Ä–µ–≥–∏—Å—Ç—Ä–µ eax (–∞ 64-–±–∏—Ç–Ω–æ–µ ‚Äî –≤ –ø–∞—Ä–µ eax:edx);

    caller-saved —Ä–µ–≥–∏—Å—Ç—Ä—ã: eax, ecx –∏ edx;
    callee-saved —Ä–µ–≥–∏—Å—Ç—Ä—ã: –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ.
–í–æ–æ—Ä—É–∂—ë–Ω–Ω—ã–µ —ç—Ç–∏–º –∑–Ω–∞–Ω–∏–µ–º, –º—ã —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ–º –≤—ã–∑—ã–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ –°–∏ –∏ –±—ã—Ç—å –∏–º–∏ –≤—ã–∑–≤–∞–Ω—ã:
```
    // int foobar(int a, int b)

    pushl b
    pushl a
    call foobar
    add $8, %esp

    // –≤–æ–∑–≤—Ä–∞—â—ë–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ª–µ–∂–∏—Ç –≤ %eax
    // –≤–æ–∑–º–æ–∂–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ foobar
    .global foobar
foobar:
    // —Å–µ–π—á–∞—Å —Å—Ç–µ–∫ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫: ra  a  b
    mov 4(%esp), %eax
    add 8(%esp), %eax
    ret
```

–õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
–ü–æ–¥ –Ω–∏—Ö –º—ã –≤—ã–¥–µ–ª—è–µ–º –º–µ—Å—Ç–æ –Ω–∞ —Å—Ç–µ–∫–µ:
```
baz:
    sub $8, %esp   // –≤—ã–¥–µ–ª–∏–ª–∏ —Å–µ–±–µ 8 –±–∞–π—Ç, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ —á—Ç–æ
    push $0        // –≤—ã–¥–µ–ª–∏–ª–∏ —Å–µ–±–µ 4 –±–∞–π—Ç–∞, –≤ –∫–æ—Ç–æ—Ä—ã—Ö 0
    // —Å–µ–π—á–∞—Å —Å—Ç–µ–∫ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫: 0  ?  ?  ra  arg1  arg2...
```
–ß—Ç–æ–±—ã –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ —Ñ—É–Ω–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ esp, –ø—Ä–∏–¥—ë—Ç—Å—è –ø–æ–º–Ω–∏—Ç—å, –Ω–∞ —Å–∫–æ–ª—å–∫–æ –º—ã —ç—Ç–æ—Ç esp —Å–º–µ—Å—Ç–∏–ª–∏:

    mov 16(%esp), %eax  // –¥–æ—Å—Ç–∞–ª–∏ –ø–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç

## –°—Ç–µ–∫–æ–≤—ã–π –∫–∞–¥—Ä
–ü—Ä–∏–Ω—è—Ç–æ –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ —Ñ—É–Ω–∫—Ü–∏—é —Å–æ—Ö—Ä–∞–Ω—è—Ç—å esp –≤ —Ä–µ–≥–∏—Å—Ç—Ä–µ ebp (base pointer), –∞ —Å–∞–º ebp —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ –≤ —Å—Ç–µ–∫–µ:
```
quux:
    push %ebp
    mov %esp, %ebp

    /*
    stack layout:  oldebp  ra  arg1  arg2...
                   ‚Üë ebp
    
    arg1: 8(%ebp)
    arg2: 12(%ebp)...

    local var 1: -4(%ebp)
    local var 2: -8(%ebp)...
    */

    ...

    mov %ebp, %esp
    pop %ebp
    ret
```
–°—Ç–µ–∫–æ–≤—ã–π –∫–∞–¥—Ä (stack frame):
```
    ‚îÇ   ...         ‚îÇ
    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
    ‚îÇ  saved ebp    ‚îÇ ‚óÑ‚îÄ‚îê
    ‚îÇ               ‚îÇ   ‚îÇ
    ‚îÇ               ‚îÇ   ‚îÇ
    ‚îÇ               ‚îÇ   ‚îÇ
    ‚îÇ  arg2         ‚îÇ   ‚îÇ
    ‚îÇ  arg1         ‚îÇ   ‚îÇ
    ‚îÇ  return addr  ‚îÇ   ‚îÇ
    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§   ‚îÇ
ebp‚Üí‚îÇ  saved ebp    ‚îÇ ‚îÄ‚îÄ‚îò
    ‚îÇ  local1       ‚îÇ
esp‚Üí‚îÇ  local2       ‚îÇ
    ‚îÇ               ‚îÇ
```

## –¢–µ–∫—Å—Ç –ö–æ–¥–∏—Ä–æ–≤–∫–∞ ASCII.

```
greeting:
    .byte 'H'  // —Ç–æ –∂–µ, —á—Ç–æ .byte 0x48
    .byte 'i'  // —Ç–æ –∂–µ, —á—Ç–æ .byte 0x69
    .byte ' '
    .ascii "guy"
    .asciz "s"  // —Ç–æ –∂–µ, —á—Ç–æ .ascii "s\0"

    .asciz "Hi guys"  // –µ—â—ë —Ä–∞–∑ —Ç–∞ –∂–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±–∞–π—Ç
```